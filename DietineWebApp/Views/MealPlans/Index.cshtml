@model DietineWebApp.Models.MealPlan

@{ ViewData["Title"] = "Meal Plan"; }

<!-- Header -->
<header class="ex-header-smaller">
    <div class="container">
        <div class="row">
            <div class="col-xl-10 offset-xl-1">
                <h1>Your Meal Plan</h1>
            </div> <!-- end of col -->
        </div> <!-- end of row -->
    </div> <!-- end of container -->
</header> <!-- end of ex-header -->
<!-- end of header -->
<!-- Basic -->
<div class="ex-basic-1 pt-4">
    <div class="container">
        <div class="row">
            <div class="col-xl-10 offset-xl-1">
                <form asp-action="ProcessAddition">
                    <div class="container">
                        <div class="form-group col-md-3">
                            <div class="input-group">
                                <span class="input-group-text" id="basic-addon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-calendar-date" viewBox="0 0 16 16">
                                        <path d="M6.445 11.688V6.354h-.633A12.6 12.6 0 0 0 4.5 7.16v.695c.375-.257.969-.62 1.258-.777h.012v4.61h.675zm1.188-1.305c.047.64.594 1.406 1.703 1.406 1.258 0 2-1.066 2-2.871 0-1.934-.781-2.668-1.953-2.668-.926 0-1.797.672-1.797 1.809 0 1.16.824 1.77 1.676 1.77.746 0 1.23-.376 1.383-.79h.027c-.004 1.316-.461 2.164-1.305 2.164-.664 0-1.008-.45-1.05-.82h-.684zm2.953-2.317c0 .696-.559 1.18-1.184 1.18-.601 0-1.144-.383-1.144-1.2 0-.823.582-1.21 1.168-1.21.633 0 1.16.398 1.16 1.23z" />
                                        <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4H1z" />
                                    </svg>
                                </span>
                                <input asp-for="Tanggal" type="date" class="form-control" value="@Model.Tanggal" id="dateBox" />
                            </div>
                        </div>
                    </div>

                    <h3>Breakfast</h3>
                    <p>
                        <input class="btn btn-primary" type="submit" name="breakfast" value="Browse" />
                        @*<a asp-controller="BreakfastFoods" asp-action="Create">Create Food</a><br />
                            <a asp-controller="BreakfastFoods" asp-action="SeeList" asp-route-date="@Model.Tanggal">Browse Food</a>*@
                    </p>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>
                                    <p>Name</p>
                                </th>
                                <th>
                                    <p>Calorie Ratio (kcal/100gr)</p>
                                </th>
                                <th>
                                    <p>Amount (gr)</p>
                                </th>
                                <th>
                                    <p>Total Calorie (kcal)</p>
                                </th>
                                <th class="collapse">
                                    <p>Date</p>
                                </th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.BreakfastList)
                            {
                <tr class="dateList">
                    <td>
                        @Html.DisplayFor(modelItem => item.BFName)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.BFCaloriePerOunce)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.BFGram)
                    </td>
                    <td class="total">
                        @Html.DisplayFor(modelItem => item.BFTotalCalorie)
                    </td>
                    <td class="collapse">
                        @Html.DisplayFor(modelItem => item.BFDate)
                    </td>
                    <td>
                        <a asp-action="Edit" asp-controller="BreakfastFoods" asp-route-id="@item.BreakfastFoodID">Edit</a> |
                        @*<a asp-action="Details" asp-controller="BreakfastFoods" asp-route-id="@item.BreakfastFoodID">Details</a> |*@
                        <a asp-action="Delete" asp-controller="BreakfastFoods" asp-route-id="@item.BreakfastFoodID">Delete</a>
                    </td>
                </tr>
}
                        </tbody>
                    </table>

                    <h3>Lunch</h3>

                    <p>
                        <input class="btn btn-primary" type="submit" name="lunch" value="Browse" />
                        @*<a asp-controller="LunchFoods" asp-action="Create">Create Food</a><br />
                            <a asp-controller="LunchFoods" asp-action="SeeList">Browse Food</a>*@
                    </p>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>
                                    <p>Name</p>
                                </th>
                                <th>
                                    <p>Calorie Ratio (kcal/100gr)</p>
                                </th>
                                <th>
                                    <p>Amount (gr)</p>
                                </th>
                                <th>
                                    <p>Total Calorie (kcal)</p>
                                </th>
                                <th class="collapse">
                                    <p>Date</p>
                                </th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.LunchList)
                            {
                <tr class="dateList">
                    <td>
                        @Html.DisplayFor(modelItem => item.LFName)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.LFCaloriePerOunce)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.LFGram)
                    </td>
                    <td class="total">
                        @Html.DisplayFor(modelItem => item.LFTotalCalorie)
                    </td>
                    <td class="collapse">
                        @Html.DisplayFor(modelItem => item.LFDate)
                    </td>
                    <td>
                        <a asp-action="Edit" asp-controller="LunchFoods" asp-route-id="@item.LunchFoodID">Edit</a> |
                        @*<a asp-action="Details" asp-controller="LunchFoods" asp-route-id="@item.LunchFoodID">Details</a> |*@
                        <a asp-action="Delete" asp-controller="LunchFoods" asp-route-id="@item.LunchFoodID">Delete</a>
                    </td>
                </tr>
}
                        </tbody>
                    </table>


                    <h3>Dinner</h3>

                    <p>
                        <input class="btn btn-primary" type="submit" name="dinner" value="Browse" />
                        @*<a asp-controller="DinnerFoods" asp-action="Create">Create Food</a><br />
                            <a asp-controller="DinnerFoods" asp-action="SeeList">Browse Food</a>*@
                    </p>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>
                                    <p>Name</p>
                                </th>
                                <th>
                                    <p>Calorie Ratio (kcal/100gr)</p>
                                </th>
                                <th>
                                    <p>Amount (gr)</p>
                                </th>
                                <th>
                                    <p>Total Calorie (kcal)</p>
                                </th>
                                <th class="collapse">
                                    <p>Date</p>
                                </th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.DinnerList)
                            {
                <tr class="dateList">
                    <td>
                        @Html.DisplayFor(modelItem => item.DFName)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.DFCaloriePerOunce)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.DFGram)
                    </td>
                    <td class="total">
                        @Html.DisplayFor(modelItem => item.DFTotalCalorie)
                    </td>
                    <td class="collapse">
                        @Html.DisplayFor(modelItem => item.DFDate)
                    </td>
                    <td>
                        <a asp-action="Edit" asp-controller="DinnerFoods" asp-route-id="@item.DinnerFoodID">Edit</a> |
                        @*<a asp-action="Details" asp-controller="DinnerFoods" asp-route-id="@item.DinnerFoodID">Details</a> |*@
                        <a asp-action="Delete" asp-controller="DinnerFoods" asp-route-id="@item.DinnerFoodID">Delete</a>
                    </td>
                </tr>
}
                        </tbody>
                    </table>

                    <h1>Your Activities</h1>

                    <p>
                        <input class="btn btn-primary" type="submit" name="activity" value="Browse" />
                        @*<a asp-controller="TakenActivities" asp-action="Create">Create Activity</a><br />
                            <a asp-controller="TakenActivities" asp-action="SeeList">Browse Activity</a>*@
                    </p>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>
                                    <p>Name</p>
                                </th>
                                <th>
                                    <p>Burned Calorie Ratio (kcal/minute)</p>
                                </th>
                                <th>
                                    <p>Duration (minute)</p>
                                </th>
                                <th>
                                    <p>Total Calorie Burned (kcal)</p>
                                </th>
                                <th class="collapse">
                                    <p>Date</p>
                                </th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.ActivityList)
                            {
                <tr class="dateList">
                    <td>
                        @Html.DisplayFor(modelItem => item.TAName)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.TACalorieBurnedPerMinute)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.TAMinute)
                    </td>
                    <td class="total">
                        @Html.DisplayFor(modelItem => item.TATotalCaloriBurned)
                    </td>
                    <td class="collapse">
                        @Html.DisplayFor(modelItem => item.TADate)
                    </td>
                    <td>
                        <a asp-action="Edit" asp-controller="TakenActivities" asp-route-id="@item.TakenActivityID">Edit</a> |
                        @*<a asp-action="Details" asp-controller="TakenActivities" asp-route-id="@item.TakenActivityID">Details</a> |*@
                        <a asp-action="Delete" asp-controller="TakenActivities" asp-route-id="@item.TakenActivityID">Delete</a>
                    </td>
                </tr>}
                        </tbody>
                    </table>
                </form>

                <h3>Total Calorie: <span id="accumulation">0</span> kcal</h3>

            </div> <!-- end of col -->
        </div> <!-- end of row -->
    </div> <!-- end of container -->
</div> <!-- end of ex-basic-1 -->
<!-- end of basic -->

@section Scripts{
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script>
        $(document).ready(function () {
            function Contains(item1, item2) {
                if (item1.indexOf(item2) != -1) return true;
            }

            // Initial State (Date of Today)
            var searchDate = document.querySelector('input[type="date"]');
            var totalCalorie = 0;
            $(".dateList").each(function () {
                if (!Contains($(this).text().toLowerCase(), searchDate.value)) {
                    $(this).hide();
                } else {
                    var calorie = $(this).find(".total").text();
                    totalCalorie += parseFloat(calorie);
                    $(this).show();
                }
            })
            $("#accumulation").text(totalCalorie)

            // Searching state (Inputted Date)
            $("#dateBox").change(function () {
                totalCalorie = 0;
                searchDate = document.querySelector('input[type="date"]');
                $(".dateList").each(function () {
                    if (!Contains($(this).text().toLowerCase(), searchDate.value)) {
                        $(this).hide();
                    } else {
                        var calorie = $(this).find(".total").text();
                        totalCalorie += parseFloat(calorie);
                        $(this).show();
                    }
                })
                $("#accumulation").text(totalCalorie)
            });
        });
    </script>
}